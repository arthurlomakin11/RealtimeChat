variables:
  - group: GitHubSecrets

steps:
  - checkout: self
    persistCredentials: true 
    fetchDepth: 0 

  - script: |
      git config --global user.email "arthurlomakin11@gmail.com"
      git config --global user.name "Azure DevOps Sync"
        
      git remote remove github || true
      git remote add github https://$(GITHUB_TOKEN)@github.com/arthurlomakin11/RealtimeChat.git
      git fetch github
            
      if git merge github/master --no-edit --no-commit; then
        echo "Merge completed successfully"
        git commit -m "Auto-merge from GitHub [skip ci]"
        git push origin master
      else
        echo "##vso[task.logissue type=warning]Merge conflict detected - forcing GitHub changes"
        git merge --abort
        git reset --hard github/master
        git push origin master --force
      fi
    displayName: 'Sync from GitHub (merge or force)'
    env:
      GITHUB_TOKEN: $(GITHUB_TOKEN)